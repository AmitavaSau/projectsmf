$(".input-number").keypress(function (key) {
	if (key.charCode == 0) return true;
	if (key.charCode < 48 || key.charCode > 57) return false;
});

function is_aplhabets(val) {
	var regex = new RegExp("^[a-zA-Z ]+$");
	if (regex.test(val.trim())) {
		return true;
	} else {
		return false;
	}
}

//blank field
function blank_field(value) {
	if (value.trim() == "") {
		return true;
	} else {
		return false;
	}
}

$("input.decimal").bind("change keyup input", function () {
	var position = this.selectionStart - 1;
	//remove all but number and .
	var fixed = this.value.replace(/[^0-9\.]/g, "");
	if (fixed.charAt(0) === ".")
		//can't start with .
		fixed = fixed.slice(1);

	var pos = fixed.indexOf(".") + 1;
	if (pos >= 0)
		//avoid more than one .
		fixed = fixed.substr(0, pos) + fixed.slice(pos).replace(".", "");

	if (this.value !== fixed) {
		this.value = fixed;
		this.selectionStart = position;
		this.selectionEnd = position;
	}
});

//show error message
function showError(ele, msg) {
	$("#" + ele).addClass("error");
	$("#" + ele)
		.parent()
		.append('<p class="my-0"><small class="error">' + msg + "</small></p>");
	error = true;
}

//hide error message
function hideError(ele) {
	$("#" + ele).removeClass("error");
	$("#" + ele)
		.parent()
		.find($(".error"))
		.remove();
}

$(document).on("click", ".marks_entry_search", function () {
	var error_step2 = false;
	var error_msg = "";

	var inst_code = $("#inst_code").val();
	hideError("inst_code");
	if (inst_code == "") {
		showError("inst_code", "College is required");
		error_step2 = true;
	}

	var course_name = $("#course_name").val();
	hideError("course_name");
	if (course_name == "") {
		showError("course_name", "Course is required");
		error_step2 = true;
	}

	var cand_paper = $("#cand_paper").val();
	hideError("cand_paper");
	if (cand_paper == "") {
		showError("cand_paper", "Paper is required");
		error_step2 = true;
	}

	var cand_paper_seg = $("#cand_paper_seg").val();
	hideError("cand_paper_seg");
	if (cand_paper_seg == "") {
		showError("cand_paper_seg", "Paper Segments is required");
		error_step2 = true;
	}
	if (!error_step2) {
		window.location.href =
			"marks_entry_preliminary?inst_code=" +
			inst_code +
			"&course_name=" +
			course_name +
			"&cand_paper=" +
			cand_paper +
			"&cand_paper_seg=" +
			cand_paper_seg;
	} else {
		swal("Opps!", "Please fillup the required field(s)", "warning");
	}
});

$(document).on("change", ".cand_marks_opt", function () {
	var remarksField = $(this).closest("tr").find(".cand_marks_remarks");
	remarksField.val("");
});

$(document).on("change", ".cand_marks_remarks", function () {
	var marksField = $(this).closest("tr").find(".cand_marks_opt");
	marksField.val("");
});

$(document).on("click", ".marks_entry_save", function () {
	var error = false;
	var inst_code = $("#inst_code").val();
	var course_name = $("#course_name").val();
	var cand_paper = $("#cand_paper").val();
	var cand_paper_seg = $("#cand_paper_seg").val();

	var num = $(this).data("markscount");

	var cand_marks_opt = $(".cand_marks_opt")
		.eq(num - 1)
		.val();

	var cand_marks_remarks = $(".cand_marks_remarks")
		.eq(num - 1)
		.val();
	var pre_cand_code = $(".pre_cand_code")
		.eq(num - 1)
		.val();

	//alert(collected_omr_no);
	//alert('a');

	if (cand_marks_opt < 0 || cand_marks_opt > 100) {
		error = true;
	}

	if (!error) {
		if (cand_marks_opt == "" && cand_marks_remarks == "") {
			swal("INVALID DATA");
		} else {
			var param = {
				cand_paper: cand_paper,
				cand_paper_seg: cand_paper_seg,
				cand_marks_opt: cand_marks_opt,
				cand_marks_remarks: cand_marks_remarks,
				pre_cand_code: pre_cand_code,
			};
			//alert(param);
			$.ajax({
				url: BASE_URL + "examMarks/marks_save_preliminary",
				data: param,
				type: "post",
				dataType: "json",
				success: function (res) {
					swal("Success!", "Submitted successfully!", "success").then(() => {
						window.location.href =
							"marks_entry_preliminary?inst_code=" +
							inst_code +
							"&course_name=" +
							course_name +
							"&cand_paper=" +
							cand_paper +
							"&cand_paper_seg=" +
							cand_paper_seg;
					});
				},
			});
		}
	} else {
		swal("Opps!", "Invalid Marks Optained", "warning");
	}
});

$(document).on("click", ".download_report_preliminary", function () {
	var inst_code = $("#inst_code").val();
	var course_name = $("#course_name").val();
	var cand_paper = $("#cand_paper").val();
	var cand_paper_seg = $("#cand_paper_seg").val();

	window.location.href =
		"download_report_preliminary?inst_code=" +
		inst_code +
		"&course_name=" +
		course_name +
		"&cand_paper=" +
		cand_paper +
		"&cand_paper_seg=" +
		cand_paper_seg;
});

//FOR FINAL

$(document).on("click", ".marks_entry_search_final", function () {
	var error_step2 = false;
	var error_msg = "";

	var inst_code = $("#inst_code").val();
	hideError("inst_code");
	if (inst_code == "") {
		showError("inst_code", "College is required");
		error_step2 = true;
	}

	var course_name = $("#course_name").val();
	hideError("course_name");
	if (course_name == "") {
		showError("course_name", "Course is required");
		error_step2 = true;
	}

	var cand_paper = $("#cand_paper").val();
	hideError("cand_paper");
	if (cand_paper == "") {
		showError("cand_paper", "Paper is required");
		error_step2 = true;
	}

	var cand_paper_seg = $("#cand_paper_seg").val();
	hideError("cand_paper_seg");
	if (cand_paper_seg == "") {
		showError("cand_paper_seg", "Paper Segments is required");
		error_step2 = true;
	}
	if (!error_step2) {
		window.location.href =
			"marks_entry_final?inst_code=" +
			inst_code +
			"&course_name=" +
			course_name +
			"&cand_paper=" +
			cand_paper +
			"&cand_paper_seg=" +
			cand_paper_seg;
	} else {
		swal("Opps!", "Please fillup the required field(s)", "warning");
	}
});

$(document).on("click", ".marks_entry_save_final", function () {
	var error = false;
	var inst_code = $("#inst_code").val();
	var course_name = $("#course_name").val();
	var cand_paper = $("#cand_paper").val();
	var cand_paper_seg = $("#cand_paper_seg").val();

	var num = $(this).data("markscount");

	var cand_marks_opt = $(".cand_marks_opt")
		.eq(num - 1)
		.val();

	var cand_marks_remarks = $(".cand_marks_remarks")
		.eq(num - 1)
		.val();
	var pre_cand_code = $(".pre_cand_code")
		.eq(num - 1)
		.val();

	//alert(collected_omr_no);
	//alert('a');

	if (cand_marks_opt < 0 || cand_marks_opt > 100) {
		error = true;
	}

	if (!error) {
		if (cand_marks_opt == "" && cand_marks_remarks == "") {
			swal("INVALID DATA");
		} else {
			var param = {
				cand_paper: cand_paper,
				cand_paper_seg: cand_paper_seg,
				cand_marks_opt: cand_marks_opt,
				cand_marks_remarks: cand_marks_remarks,
				pre_cand_code: pre_cand_code,
			};
			//alert(param);
			$.ajax({
				url: BASE_URL + "examMarks/marks_save_final",
				data: param,
				type: "post",
				dataType: "json",
				success: function (res) {
					swal("Success!", "Submitted successfully!", "success").then(() => {
						window.location.href =
							"marks_entry_final?inst_code=" +
							inst_code +
							"&course_name=" +
							course_name +
							"&cand_paper=" +
							cand_paper +
							"&cand_paper_seg=" +
							cand_paper_seg;
					});
				},
			});
		}
	} else {
		swal("Opps!", "Invalid Marks Optained", "warning");
	}
});

$(document).on("click", ".download_report_final", function () {
	var inst_code = $("#inst_code").val();
	var course_name = $("#course_name").val();
	var cand_paper = $("#cand_paper").val();
	var cand_paper_seg = $("#cand_paper_seg").val();

	window.location.href =
		"download_report_final?inst_code=" +
		inst_code +
		"&course_name=" +
		course_name +
		"&cand_paper=" +
		cand_paper +
		"&cand_paper_seg=" +
		cand_paper_seg;
});

//Institute Details
$(document).on("click", ".btn-save-institute-details", function () {
	var error_step2 = false;

	var col_center_in_charge_name = $("#col_center_in_charge_name").val();
	hideError("col_center_in_charge_name");
	if (blank_field(col_center_in_charge_name)) {
		error_step2 = true;
		showError("col_center_in_charge_name", "Name can't blank");
	} else if (!is_aplhabets(col_center_in_charge_name)) {
		error_step2 = true;
		showError("col_center_in_charge_name", "Invalid Name");
	}

	var col_name = $("#col_name").val();
	hideError("col_name");
	if (blank_field(col_name)) {
		error_step2 = true;
		showError("col_name", "Institution / College can't blank");
	}

	var col_center_address_1 = $("#col_center_address_1").val();
	hideError("col_center_address_1");
	if (blank_field(col_center_address_1)) {
		error_step2 = true;
		showError("col_center_address_1", "Address can't blank");
	}

	var col_center_address_2 = $("#col_center_address_2").val();
	hideError("col_center_address_2");
	if (blank_field(col_center_address_2)) {
		error_step2 = true;
		showError("col_center_address_2", "Address can't blank");
	}

	var col_center_state = $("#col_center_state").val();
	hideError("col_center_state");
	if (blank_field(col_center_state)) {
		error_step2 = true;
		showError("col_center_state", "State can't blank");
	}

	var col_center_dist = $("#col_center_dist").val();
	hideError("col_center_dist");
	if (blank_field(col_center_dist)) {
		error_step2 = true;
		showError("col_center_dist", "District can't blank");
	}

	var col_center_pin = $("#col_center_pin").val();
	hideError("col_center_pin");
	if (blank_field(col_center_pin)) {
		error_step2 = true;
		showError("col_center_pin", "Pin Code can't blank");
	} else if ("6" != col_center_pin.length) {
		showError("col_center_pin", "Invalid Pin Code");
		error_step2 = true;
	}

	var col_center_mob = $("#col_center_mob").val();
	hideError("col_center_mob");
	if (blank_field(col_center_mob)) {
		error_step2 = true;
		showError("col_center_mob", "Mobile can't blank");
	} else if ("10" != col_center_mob.length) {
		showError("col_center_mob", "Invalid Mobile");
		error_step2 = true;
	}

	var col_center_email = $("#col_center_email").val();
	hideError("col_center_email");
	var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;
	if (col_center_email == "") {
		showError("col_center_email", "Email Address is required");
		error_step2 = true;
	} else if (!regex.test(col_center_email)) {
		showError("col_center_email", "Email Address is not valid");
		error_step2 = true;
	}

	setTimeout(function () {
		if (error_step2) {
			swal("Opps!", "Please fillup the required field(s)", "warning");
		} else {
			$("#institute_edit").submit();
		}
	}, 3000);
});
