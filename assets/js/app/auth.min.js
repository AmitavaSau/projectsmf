//print urls
function printPermissionUrl(arr) {
	var s	=	'';
	
	for(var i=0; i<arr.length; i++) {
		var checked	=	'';
		if(arr[i].has_access == 1) {
			checked = "checked";
		}
		s	+=	'<tr>';
		s	+=	'<td>' + (i+1) + '</td>';
		s	+=	'<td>' + arr[i].url_name + '</td>';
		s	+=	'<td>' + arr[i].url_description + '</td>';
		s	+=	'<td class="text-center">';
		s	+=	'<input type="checkbox" name="acl" class="acl" value="' + arr[i].url_id + '" ' + checked + '>';
		s 	+=  '</td>';
		s	+=	'</tr>';
	}
	
	$('#acl_list').show();
	$('#acl_list').find('tbody').html(s);
}

//change permission module dropdown
$(document).on('click','.change-module',function() {
		var module	=	$('#module_name').val();
		var role_id	=	$('#hidden_role_id').val();
		var params	=	'';
		var csrf	=	$('input[name="csrf_ax_token"]').val();
		if(module != '') {
			params	=	"module="+module+"&role_id="+role_id+"&csrf_ax_token="+csrf;
			$.ajax({
					url: BASE_URL + "auth/load_urls",
					type: "post",
					data: params,
					dataType: "json",
					success: function(res){
						if(res.error) {
							swal("Oops!", res.msg, "error");
						}
						else {
							console.log(res.token);
							printPermissionUrl(res.data);
						}
						//update CSRF token
						$('input[name="csrf_ax_token"]').val(res.token);
					}
				});		
		}
		else {
			//swal("Oops!", "Module, URL & Description can'\t be blank", "warning");
		}
	});

//assign url access	to roles
$(document).on('click','.btn-assign-access',function() {
		var aclChk	= 	$('.acl:checked').length;
	
		if(aclChk == 0) {
			swal("Oops!", "Please select atleast one URL", "warning");
		}else {
			var aclChkValues		=	[];
			if(aclChk > 0) {
				aclChkValues 		= $('.acl:checked').map(function()
					{
						return $(this).val();
					}).get();	
			}
			//console.log(aclChkValues);	
			$("#hidden_acl").val(aclChkValues);
			if(aclChkValues.length > 0) {
				this.form.submit();
			}					            
		}
	});
