$(".input-number").keypress(function (key) {
	if (key.charCode == 0) return true;
	if (key.charCode < 48 || key.charCode > 57) return false;
});

document.addEventListener("DOMContentLoaded", function () {
	flatpickr(".as_date", {
		dateFormat: "d-m-Y", // Customize the format
	});
});

//blank field
function blank_field(value) {
	if (value.trim() == "") {
		return true;
	} else {
		return false;
	}
}

//show error message
function showError(ele, msg) {
	$("#" + ele).addClass("error");
	$("#" + ele)
		.parent()
		.append('<p class="my-0"><small class="error">' + msg + "</small></p>");
	error = true;
}

//hide error message
function hideError(ele) {
	$("#" + ele).removeClass("error");
	$("#" + ele)
		.parent()
		.find($(".error"))
		.remove();
}

$(document).on("click", ".final_award_sheet_search", function () {
	var error_step2 = false;
	var error_msg = "";

	var inst_code = $("#inst_code").val();
	hideError("inst_code");
	if (inst_code == "") {
		showError("inst_code", "College is required");
		error_step2 = true;
	}

	var course_name = $("#course_name").val();
	hideError("course_name");
	if (course_name == "") {
		showError("course_name", "Course is required");
		error_step2 = true;
	}

	if (!error_step2) {
		window.location.href =
			"final_award_sheet?inst_code=" +
			inst_code +
			"&course_name=" +
			course_name;
	} else {
		swal("Opps!", "Please fillup the required field(s)", "warning");
	}
});

$(document).on("click", ".final_award_sheet_save", function () {
	var error = false;

	var num = $(this).data("count");

	var award_duration_practical_from = $(".award_duration_practical_from")
		.eq(num - 1)
		.val();

	var award_duration_practical_to = $(".award_duration_practical_to")
		.eq(num - 1)
		.val();

	var award_total_hours = $(".award_total_hours")
		.eq(num - 1)
		.val();

	var award_year_of_passing = $(".award_year_of_passing")
		.eq(num - 1)
		.val();

	var award_date = $(".award_date")
		.eq(num - 1)
		.val();

	var award_code = $(".award_code")
		.eq(num - 1)
		.val();

	if (award_total_hours <= 0) {
		error = true;
	}

	if (
		!award_duration_practical_from ||
		!award_duration_practical_to ||
		!award_total_hours ||
		!award_year_of_passing
	) {
		error = true;
		swal("Error!", "All fields must be filled out.", "error");
		//alert("All fields must be filled out.");
	}

	function parseDate(dateString) {
		var parts = dateString.split("-");
		return new Date(parts[2], parts[1] - 1, parts[0]);
	}

	if (
		parseDate(award_duration_practical_from) >
		parseDate(award_duration_practical_to)
	) {
		error = true;
		swal("Error!", "'From' date must be before 'To' date.", "error");
		//alert("'From' date must be before 'To' date.");
	}

	if (!error) {
		var param = {
			award_duration_practical_from: award_duration_practical_from,
			award_duration_practical_to: award_duration_practical_to,
			award_total_hours: award_total_hours,
			award_year_of_passing: award_year_of_passing,
			award_date: award_date,
			award_code: award_code,
		};
		//alert(param);
		$.ajax({
			url: BASE_URL + "smfAdmin/final_award_sheet_save",
			data: param,
			type: "post",
			dataType: "json",
			success: function (res) {
				if (res.status === "success") {
					swal("Success!", res.message, "success");
				} else {
					swal("Error!", res.message, "error");
				}
			},
			error: function () {
				swal("Error!", "An unexpected error occurred.", "error");
			},
		});
	} /*  else {
		swal("Opps!", "Invalid Marks Optained", "warning");
	} */
});

$(document).on("click", ".download_report_award_sheet", function () {
	var inst_code = $("#inst_code").val();
	var course_name = $("#course_name").val();

	window.location.href =
		"final_award_sheet_report?inst_code=" +
		inst_code +
		"&course_name=" +
		course_name;
});

/* ------------  DATA VIEWING ------------ */

$(document).on("click", ".btn-dfharma-search", function () {
	var cand_code = $("#cand_code").val();
	var params = "cand_code=" + cand_code;

	var loadUrl = BASE_URL + "smfAdmin/data_viewing_dfharma/" + cand_code;

	window.location.href = loadUrl;
});

$(document).on("click", ".btn-final-search", function () {
	var cand_code = $("#cand_code").val();
	var params = "cand_code=" + cand_code;

	var loadUrl = BASE_URL + "smfAdmin/data_viewing_final/" + cand_code;

	window.location.href = loadUrl;
});
